<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="systemStyle.css">
    <title>BC</title>
</head>

<body>

    <main>
        <div class="spanMessage">
            <div class="spanMessageText"></div>
        </div>
        <div class="systemNavContainer">

        </div>

        <section class="login">
            <div class="cardLogin">
                <h5>LogIn</h5>

                <div class="form_group field">
                    <input type="text" id="emailInput" name="email" placeholder="Email" class="logInput" required>
                    <label for="email" class="logLabel">Email</label>
                </div>

                <div class="form_group field">
                    <input type="password" id="passwordInput" name="password" placeholder="Senha" class="logInput"
                        required>
                    <label for="password" class="logLabel">Password</label>
                </div>

                <input type="button" value="Log-in" id="bt">
            </div>
        </section>

        <section class="createEnterpriseUser">
            <div class="gridUsers">

                <div class="side">
                    <div class="userConsultCard">
                        <div class="searchUserContainer">
                            <div class="searchBarContainer">
                                <input type="text" name="searchUser" id="searchUser" placeholder="Search...">
                                <button id="searchUserBt">Search</button>
                                
                                    <label for="departmentFilter">Department:</label>
                                    <select id="departmentFilter">
                                        <option value="">All</option>
                                        <option value="development">Development</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Sales">Sales</option>
                                        <option value="HR">HR</option>
                                    </select>

                                    <label for="sortOrder">Sort By:</label>
                                    <select id="sortOrder">
                                        <option value="name">Name</option>
                                        <option value="date">Date</option>
                                    </select>
                            </div>
                        </div>
                        <div class="userListContainer">

                        </div>
                    </div>
                </div>


                <!-- <aside class="side">
                    <div class="userEnterpriseRegisterCard">
                        <h1>Register User</h1>
                        <input type="text" id="userNameEnterpriseRegister" placeholder="Full name">
                        <input type="text" id="userEmailEnterpriseRegister" placeholder="Email">

                        <div class="departmentContainder">
                            <label for="department">Department:</label>
                            <select id="department" name="department">
                                <option value="Development">Development</option>
                                <option value="Quality Assurance (QA)">Quality Assurance (QA)</option>
                                <option value="Product Management">Product Management</option>
                                <option value="User Experience (UX) Design">User Experience (UX) Design</option>
                                <option value="DevOps (Development Operations)">DevOps (Development Operations)</option>
                                <option value="Technical Support">Technical Support</option>
                                <option value="Sales and Marketing">Sales and Marketing</option>
                                <option value="Human Resources (HR)">Human Resources (HR)</option>
                                <option value="Finance and Accounting">Finance and Accounting</option>
                                <option value="Information Technology (IT)">Information Technology (IT)</option>
                                <option value="Admin">Admin</option>

                            </select>
                        </div>

                        <input type="password" id="userPasswordEnterpriseRegister" placeholder="Password">
                        <input type="password" id="userConfirmPasswordEnterpriseRegister"
                            placeholder="Confirm password">
                        <input type="date" id="userBirthDateRegister" placeholder="Birth date">

                        <button id="registerUserBt" value="Register user">
                            <span>Register user</span>
                        </button>
                    </div>
                </aside> -->
            </div>
        </section>

        <section class="content">
            <div class="path"></div>
            <div class="gridContent">
                <div class="consultReturn" id="addPath">
                </div>
                <div class="consultReturnInfo" id="consultReturnInfo">
                    <div id="graphics"></div>

                    <div class="addModal"></div>
                </div>
            </div>
        </section>

        <section class="settings">
            <div class="profile-container">
                <div class="profile-header">
                    <img src="" alt="Foto de Fundo" class="background-img">
                    <div class="profile-picture-container">
                        <img src="${userData.imageUrl}" alt="Foto de Perfil" class="profile-picture">
                    </div>
                    <!-- Botão de lápis para ativar o modo de edição -->
                    <button id="editButton" class="edit-button">
                        <img src="assets/icons/lapis.svg" alt="Editar">
                    </button>
                </div>
                <div class="profile-info">
                    <h1 class="editable-text" data-field="username">${userData.username}</h1>
                    <h2 class="editable-text" data-field="department">${userData.department}</h2>
                    <div class="divideProfile">
                        <div class="sideOne">
                            <div class="info-sections">
                                <div class="info-box">
                                    <h3>Localização</h3>
                                    <p class="editable-text" data-field="location">Cidade, País</p>
                                </div>
                                <div class="info-box">
                                    <h3>Email</h3>
                                    <p class="editable-text" data-field="email">${userData.email}</p>
                                </div>
                                <div class="info-box">
                                    <h3>Telefone</h3>
                                    <p class="editable-text" data-field="phone">(99) 99999-9999</p>
                                </div>
                                <div class="info-box">
                                    <h3>Redes Sociais</h3>
                                    <p class="editable-text" data-field="instagram">@Instagram</p>
                                    <p class="editable-text" data-field="linkedin">@LinkedIn</p>
                                </div>
                            </div>
                        </div>
            
                        <div class="sideTwo">
                            <div class="divideSideTwo">
                                <div class="bioBox">
                                    <h3>Biography</h3>
                                    <p class="editable-text" data-field="biography">Escreva algo sobre você...</p>
                                </div>
                                <div class="insigniasBox">
                                    <h3>Insignias</h3>
                                    <p>Este campo pode ser gerado automaticamente com base no progresso do usuário.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="saveChangesButton" class="hidden">Salvar Alterações</button>
                </div>
            </div>
            
            <script>
            // Alternar entre modo de visualização e edição
            document.getElementById('editButton').addEventListener('click', () => {
                const editMode = document.getElementById('editButton').classList.toggle('editing');
                const editableElements = document.querySelectorAll('.editable-text');
            
                editableElements.forEach(element => {
                    if (editMode) {
                        // Modo de edição: substitui texto por input
                        const value = element.textContent.trim();
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = value;
                        input.dataset.field = element.dataset.field;
                        input.classList.add('edit-input');
                        element.replaceWith(input);
                    } else {
                        // Modo de visualização: substitui input por texto
                        const input = element;
                        const value = input.value.trim();
                        const p = document.createElement('p');
                        p.textContent = value;
                        p.dataset.field = input.dataset.field;
                        p.classList.add('editable-text');
                        input.replaceWith(p);
                    }
                });
            
                // Mostrar ou ocultar o botão de salvar alterações
                document.getElementById('saveChangesButton').classList.toggle('hidden', !editMode);
            });
            
            // Salvando as alterações no banco de dados
            document.getElementById('saveChangesButton').addEventListener('click', () => {
                const updatedUserData = {};
                document.querySelectorAll('.edit-input').forEach(input => {
                    updatedUserData[input.dataset.field] = input.value.trim();
                });
            
                // Exemplo: Atualizar no banco de dados
                update(ref(db, `users/enterprise/${userID}`), updatedUserData)
                    .then(() => {
                        alert('Informações atualizadas com sucesso!');
                        document.getElementById('editButton').click(); // Sai do modo de edição
                    })
                    .catch((error) => {
                        console.error("Erro ao atualizar as informações: ", error);
                        alert('Erro ao salvar alterações. Tente novamente mais tarde.');
                    });
            });
            </script>
            
            <style>
            .edit-button {
                background: none;
                border: none;
                cursor: pointer;
                position: absolute;
                top: 10px;
                right: 10px;
            }
            
            .hidden {
                display: none;
            }
            
            .edit-input {
                width: calc(100% - 20px);
                margin-bottom: 10px;
            }
            </style>
            
        </section>
    </main>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="module" src="../db/src/dataBase.js"></script>
    <script type="module" src="System.js"></script>

</body>

</html>